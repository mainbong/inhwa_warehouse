# ============================================
# tmux Configuration (Updated 2024)
# Compatible with tmux 3.0+
# Optimized for Neovim + Cloud Development
# ============================================

# ============================================
# General Settings
# ============================================

# Remap prefix from 'C-b' to 'C-a' (more ergonomic)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# True color support (essential for Neovim)
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Enable RGB colour if running in xterm
set -ga terminal-overrides ",xterm-256color:RGB"

# Start windows and panes at 1, not 0 (easier to reach)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Display tmux messages for 4 seconds
set -g display-time 4000

# Refresh status bar more often
set -g status-interval 5

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Enable mouse mode (tmux 2.1+)
set -g mouse on

# Don't rename windows automatically
set -g allow-rename off

# ============================================
# Key Bindings
# ============================================

# Reload config file
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Easy pane navigation (vim-like)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Pane resizing (Shift + arrow keys)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Fast window switching (Alt + number)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# ============================================
# Copy Mode (Vi-style)
# ============================================

# Use vi mode
setw -g mode-keys vi

# Vi-style copy/paste
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send -X rectangle-toggle

# Paste with prefix + p
bind p paste-buffer

# ============================================
# Design & Colors (Modern Style)
# ============================================

# Pane borders
set -g pane-border-style "fg=colour238,bg=colour235"
set -g pane-active-border-style "fg=colour51,bg=colour236"

# Status bar
set -g status-position bottom
set -g status-justify left
set -g status-style "fg=colour137,bg=colour234,dim"

# Status left (session name)
set -g status-left-length 40
set -g status-left "#[fg=colour232,bg=colour154,bold] #S #[fg=colour154,bg=colour234]"

# Status right (prefix indicator, date/time)
set -g status-right-length 150
set -g status-right "#{prefix_highlight} #[fg=colour233,bg=colour241,bold] %Y-%m-%d #[fg=colour233,bg=colour245,bold] %H:%M:%S "

# Window status
setw -g window-status-style "fg=colour138,bg=colour235,none"
setw -g window-status-format " #I:#W#F "

# Current window status
setw -g window-status-current-style "fg=colour81,bg=colour238,bold"
setw -g window-status-current-format " #I#[fg=colour250]:#[fg=colour255]#W#[fg=colour50]#F "

# Window with activity
setw -g window-status-activity-style "fg=colour154,bg=colour235,none"

# Bell
setw -g window-status-bell-style "fg=colour255,bg=colour1,bold"

# Messages
set -g message-style "fg=colour232,bg=colour166,bold"

# Clock mode
setw -g clock-mode-colour colour135

# ============================================
# Notification Settings
# ============================================

set -g visual-activity off
set -g visual-bell off
set -g visual-silence off
setw -g monitor-activity on
set -g bell-action none

# ============================================
# Neovim Integration
# ============================================

# Fix Neovim escape delay
set -sg escape-time 0

# Allow passthrough for OSC 52 (clipboard)
set -g set-clipboard on

# ============================================
# Plugins (TPM - Tmux Plugin Manager)
# ============================================

# Install TPM if not installed:
# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# Session management
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Copy/Paste improvements
set -g @plugin 'tmux-plugins/tmux-yank'

# Better pane management
set -g @plugin 'tmux-plugins/tmux-pain-control'

# Prefix highlight
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

# Better search
set -g @plugin 'tmux-plugins/tmux-copycat'

# Open files/URLs
set -g @plugin 'tmux-plugins/tmux-open'

# Beautiful theme (Tokyo Night)
set -g @plugin 'fabioluciano/tmux-tokyo-night'

# ============================================
# Plugin Settings
# ============================================

# tmux-resurrect: save/restore sessions
set -g @resurrect-strategy-nvim 'session'  # Restore nvim sessions
set -g @resurrect-capture-pane-contents 'on'  # Restore pane contents

# tmux-continuum: automatic save/restore
set -g @continuum-restore 'on'  # Auto restore last session
set -g @continuum-save-interval '15'  # Save every 15 minutes

# tmux-yank: copy to system clipboard
set -g @yank_selection 'clipboard'  # Use system clipboard
set -g @yank_selection_mouse 'clipboard'  # Mouse selection to clipboard

# tmux-prefix-highlight: show when prefix is pressed
set -g @prefix_highlight_fg 'colour231'
set -g @prefix_highlight_bg 'colour04'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=colour231,bg=colour05,bold'

# Tokyo Night theme settings
set -g @theme_variation 'night'  # night, storm, moon
set -g @theme_left_separator ''
set -g @theme_right_separator ''

# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'

# ============================================
# Custom Functions
# ============================================

# Quick ssh to server (customize as needed)
# bind S command-prompt -p "ssh to:" "new-window -n %1 'ssh %1'"

# Create new session
bind C-c new-session

# Find session
bind C-f command-prompt -p find-session 'switch-client -t %%'

# ============================================
# Cloud Development Optimizations
# ============================================

# Automatically set window title
set -g automatic-rename on
set -g automatic-rename-format '#{b:pane_current_path}'

# Show current path in status bar
# set -g status-right '#(cd #{pane_current_path}; git rev-parse --abbrev-ref HEAD)'

# ============================================
# Notes
# ============================================

# Prefix key: C-a
# Reload config: C-a r
# Split horizontal: C-a |
# Split vertical: C-a -
# Navigate panes: C-a h/j/k/l
# Resize panes: C-a Shift+H/J/K/L
# Copy mode: C-a [
# Paste: C-a p
# Switch windows: Alt+1-9
# New window: C-a c
# Kill pane: C-a x
# Kill window: C-a &
# Detach: C-a d
# List sessions: tmux ls
# Attach session: tmux attach -t <session>

# ============================================
# Quick Plugin Install Instructions
# ============================================

# After editing this file:
# 1. Reload tmux config: C-a r
# 2. Install plugins: C-a I (capital i)
# 3. Update plugins: C-a U
# 4. Uninstall plugins: C-a alt+u

# Plugin shortcuts:
# - tmux-resurrect:
#   * Save session: C-a C-s
#   * Restore session: C-a C-r
# - tmux-yank:
#   * Copy mode: C-a [
#   * Select with v, yank with y (auto copies to clipboard)
# - tmux-open:
#   * Open selection: o
#   * Open in editor: C-o
# - tmux-copycat:
#   * Search files: C-a C-f
#   * Search URLs: C-a C-u
#   * Search IP: C-a C-i
